---
layout: post
title:  "善用awk & sed"
---

## 自动生成python字典

今天处理文本有这么需求：目前我有几个excel文件包含了数据，要导入数据库。
用python的方式我想构建一个dict如下：

```python
data_table = {
    "docs/基础数据/主机.xlsx": "t_data_主机",
    "docs/基础数据/单位.xlsx": "t_data_单位",
}
```

首先我用find命令产生了这种格式
```bash
docs/基础数据/主机.xlsx
docs/基础数据/单位.xlsx
```

因为文件比较多，我不想自己手动一个个改，所以用了awk。awk -F可以设置多
个分隔符。我给的分隔符是'/|.xlsx'，这样就可以把每一行拆分成多个变量。
而$0是这一行文字本身。接下来我只要把$3拿出来做拼接就好了。

平时我是不太乐意用awk的（尤其是着急着做一件事时），因为陌生所以害怕折
腾太久，但如果熟悉了更多的awk技巧，编辑代码就会轻松得多了。


## 把数据库表字段取出来并转化为驼峰方式命名

```bash 
awk -F '`' '{if ($0 ~ /CREATE/) {print $0} else {print $2}}'
 db.sql |sed -E 's/_(.)/\U\1/g' 
```

awk部分通过匹配CREATE的方式把表名保留，而字段则去掉`之后输出。

sed部分：

1. -E 使用扩展的正则表达式。我记得扩展的正则比普通的正则多了一些常用的符号。
2. _(.) 是最短匹配吧？比如a_b_c，应该匹配出b和c，而不是b_c。
3. s表示substitute。g表示global，即全文替换，如果没有g，就会只替换第一个匹配的地方。
4. \U\1 应该是对匹配的第一部分作首字母转大写的动作。
