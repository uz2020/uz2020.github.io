---
layout: post
title:  "docker"
---

Docker真有意思。

写一个Dockerfile，很容易就能把环境搭建好。也不怕把主机环境搞坏，还可以同时给多个平台开发程序。

## docker mysql

我原以为docker的使用方式是：基于一个发行版本，在上面写dockerfile把环境
搭建起来。所以我就在dockerfile里面写了很多RUN指令，安装这个安装那个。
但是写这个dockerfile真的很费时，一旦写错又得重新来。而docker build时需
要下载那么多东西，写错一句就得全部重来，这不是很不合理吗？然后我的思路
就变成了dockerfile应该是通过不断基于之前的image来写的，分很多次才最终
构建好完整的环境。**但我还是错了**{:.green}。原来正确的方式是一个容器
里只提供一个服务，一个完成的环境应该由多个容器一起提供。我是怎么发现自
己错了的呢？那时我正在尝试在centos里安装mysql，却卡在了systemd start
mysqld这一步。原来docker为了安全起见，并没有给权限执行systemd。其实想
想也合理，比如一个容器要被stop时，它里面的服务该如何停止？难不成它帮我
们执行systemd stop mysqld？所以，每个容器只提供一个服务，我应该是在
stack overflow上看到别人如是说的。

像mysql这种这么大众的服务，早就有人写好了dockerfile，我们来用就是了。
使用的过程我们最关心的是如何设置帐号密码，还有如何查看日志？关于设置帐
号密码，docker的做法是在执行docker run命令提供环境变量。比如:
```bash
docker run -i -t -d -p 3306:3306 --env-file ./mysql-env.list centos/mysql-57-centos7
```

mysql-env.list:
```
MYSQL_ROOT_PASSWORD=1
```

这样在连接数据库时，root的密码就是1了。**so easy!**{:.green}

连接数据库时还有个小插曲，就是不要用localhost。如果用localhost，mysql
客户端就会去尝试用unix socket了。所以连接mysql服务端的命令应该是这样的:

```bash
mysql -h 127.0.0.1 -P 3306 -p -u root
```

关于日志怎么查看，我现在还没有搞懂，搞懂了之后再回来说两句吧。

说一句题外话，不得不赞叹，这个x220真的是太好用了。今天下午刚到手，现在
就开始intensively使用了。它虽然只配备了tn屏幕，我却觉得它比ips更适合用
于办公，眼睛看得也更舒服。而ips仅有的优势不过是好看罢了，甚至它的可视
角那么大也没有啥意义，反正屏幕也只是给自己看而已。

今天的bollocks够多的了，净扯一些无关紧要的内容来讲。接下来要专注搞搞项
目了。
